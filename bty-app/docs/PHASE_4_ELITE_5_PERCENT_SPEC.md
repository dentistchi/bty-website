# Phase 4: 엘리트 5% 기능 기획 — 우선순위·스펙

**목표**: 상위 5% 사용자(Elite) 전용 기능 후보를 정리하고, 우선순위·구현 스펙을 둔다.  
**산출물**: 4-3 기획 문서. 4-4에서 우선순위 높은 1~2개 구현.

**상위**: `docs/PHASE_4_CHECKLIST.md` 4-3 · `docs/ROADMAP_NEXT_STEPS.md` § Phase 4

---

## 1. Elite 5% 정의 (현행 유지)

- **조건**: 주간 리더보드(Weekly XP, `league_id IS NULL`)에서 **순위 ≤ ceil(참여자 수 × 0.05)**.
- **판정**: `GET /api/me/elite` → `{ isElite: boolean }`.  
  구현: `src/lib/bty/arena/eliteStatus.ts` — `getIsEliteTop5(supabase, userId)`.
- **이미 사용처**: 멘토 페이지 「상위 5%」 뱃지, 서브네임 리네임 기회(Code Tier 25 + Elite).

---

## 2. 후보 4가지 요약

| 후보 | 설명 | 비고 |
|------|------|------|
| **특별 프로젝트** | Elite 전용 미션/과제(예: 특정 시나리오 N회 완료, 리플렉션 3회 등). 완료 시 보상(배지·XP·언락). | 콘텐츠·보상 설계 필요 |
| **멘토 프로그램** | Elite가 “멘토”로 참여. 예: Elite 멘토 배지, 멘토 전용 대화/피드백 큐 노출, 또는 멘토 인증 플로우. | 역할·권한·UI 범위 정의 필요 |
| **해금 콘텐츠** | Elite일 때만 접근 가능한 스토리/시나리오/문서. 예: 특정 Arena 레벨·에피소드, Dear Me 고급 훈련. | 기존 unlock/레벨 체계와 연동 |
| **챔피언십** | 주간/시즌 단위 Elite 1~3명 등 “챔피언” 선정·공개. 리더보드 상단 강조, 배지·명예. | 시즌·리셋 정책과 정합성 유지 |

---

## 3. 우선순위 제안

| 순위 | 기능 | 이유 | 구현 난이도(상대) |
|------|------|------|-------------------|
| **1** | **해금 콘텐츠** | 기존 unlock/레벨·시나리오 구조와 바로 연결 가능. “Elite만 보는 콘텐츠” 하나만 추가해도 체감 큼. | 낮음 |
| **2** | **멘토 배지·노출** | 이미 `isElite`·멘토 페이지 뱃지 있음. “Elite 멘토” 배지·설명 확장만으로 1차 완료 가능. | 낮음 |
| **3** | **특별 프로젝트** | 미션 정의·진행 추적·보상 설계 필요. 해금 콘텐츠나 멘토 배지보다 설계 부담 큼. | 중간 |
| **4** | **챔피언십** | 시즌/주간 경계·공개 범위·정책 정리 필요. “상위 5%”와 “챔피언 1~3명” 중복·차이 정의 필요. | 중간~높음 |

---

## 4. 기능별 스펙 요약

### 4-1. 해금 콘텐츠 (우선순위 1)

- **조건**: `isElite === true` 일 때만 노출/접근 가능한 콘텐츠.
- **예시**:  
  - Arena: “Elite 전용” 시나리오 1개 또는 기존 시나리오의 Elite 전용 에피소드.  
  - 또는 Dear Me: Elite 전용 고급 훈련 1종.
- **구현 포인트**:  
  - 기존 `unlock`/레벨 체계에 “elite_only” 플래그 또는 별도 Elite 전용 목록 추가.  
  - UI: 해당 콘텐츠 진입 전/목록에서 `GET /api/me/elite` 확인, Elite 아니면 “상위 5% 달성 시 이용 가능” 메시지.
- **데이터**: 시나리오/에피소드 메타에 `elite_only: boolean` 또는 `elite_content_ids: string[]` 수준으로 확장.

### 4-2. 멘토 프로그램 — 1차: 배지·노출 (우선순위 2)

- **범위(1차)**: “Elite 멘토” 배지·텍스트.  
  - 멘토 페이지 또는 프로필/리더보드에서 Elite 사용자에게 “상위 5% · 멘토” 표시.  
  - 이미 멘토 페이지에 “상위 5%” 뱃지 있음 → “Elite 멘토” 등으로 문구·아이콘만 확장 가능.
- **확장(2차)**: “멘토 인증” 플로우, 멘토 전용 대화 큐 등은 별도 기획 후 진행.

### 4-3. 특별 프로젝트 (우선순위 3)

- **정의**: Elite 전용 미션(예: “이번 주 리플렉션 3회”, “시나리오 X 완료 1회”).  
  완료 시 보상: 배지, XP, 또는 해금 콘텐츠 열기.
- **구현 포인트**:  
  - 미션 정의·진행 상태 저장(테이블 또는 기존 이벤트 확장).  
  - Elite 조건 + 미션 완료 조건 동시 만족 시 보상 지급.  
  - UI: 대시보드/멘토에 “이번 주 특별 프로젝트” 블록.

### 4-4. 챔피언십 (우선순위 4)

- **정의**: 주간 또는 시즌 단위로 “챔피언” 1~3명 선정·공개.  
  예: 주간 1위 = Champion, 2~3위 = Runner-up.  
  리더보드 상단·별도 “챔피언십” 영역에 배지·닉네임(Code Name) 표시.
- **구현 포인트**:  
  - 주간/시즌 경계와 정합성(리셋 시점, 표시 기간).  
  - Elite(상위 5%)와 챔피언(1~3명) 구분: “Elite = 전원 혜택, 챔피언 = 상위 1~3명 명예”.
- **데이터**: 리더보드 캐시/뷰에서 상위 3명 추출, 또는 `champions` 테이블(week_id/season_id, rank, user_id).

---

## 5. 4-4 구현 시 권장 조합

- **최소 1개**: **해금 콘텐츠** 1종(Elite만 접근 가능한 시나리오/에피소드 또는 문서).  
  또는 **멘토 배지 확장**(“Elite 멘토” 문구·아이콘).
- **2개까지**: 위 둘 중 하나 + **특별 프로젝트** 1종(간단한 “이번 주 미션” + 보상).  
  챔피언십은 시즌/정책 확정 후 2차로 구현 권장.

---

## 6. 주간 5% vs 시즌 5% 엘리트 — 정책 검토 (프로젝트)

- **현행**: 주간 리더보드 상위 5%만으로 Elite 판정. 노출(뱃지 등)은 있으나 “특혜”는 제한적.
- **검토 질문**:  
  - 주간 5%를 **보여주기만** 할지, **특혜(혜택)** 를 줄지.  
  - **시즌 5% 엘리트**가 더 중요하다면, 혜택을 “시즌 기준 5%”로 바꾸거나, **주간 5% / 시즌 5%를 선택·교환 가능한 아이템**으로 할지.
- **정책 정리 (1페이지)**: **`docs/ELITE_5_PERCENT_POLICY.md`** — 주간 vs 시즌 정의, 노출 vs 특혜, 혜택 통합/분리·아이템 교환 여부 요약. PROJECT_BACKLOG §4 산출물.

---

## 7. 엘리트 특혜 아이디어 — 프로젝트에 반영

아래는 **시즌/주간 5% 엘리트에게 줄 수 있는 특혜 후보**로, 기획·우선순위 정한 뒤 4-4에서 구현한다.

| 아이디어 | 설명 | 비고 |
|----------|------|------|
| **멘토와의 대화 신청** | Elite가 특정 멘토(또는 Dr. Chi)와 1:1 대화/세션 신청 권한. 신청 큐·승인 플로우 필요. | 멘토 프로그램 확장 |
| **서클(Circle) 모임** | Elite 전용 소규모 모임(예: 주 1회 또는 월 1회). 일정·참여 UI·알림. | 커뮤니티·연대감 |
| **특별 트레이닝 세션** | Elite만 참여 가능한 트레이닝/워크숍(실시간 또는 온디맨드). 콘텐츠·참여 기록. | 해금·교육 확장 |
| **엘리트 배지 증정** | 시즌/주간 5% 달성 시 배지 수여. 기존 “상위 5%” 뱃지 확장(예: 시즌 엘리트 배지, 주간 엘리트 배지). | 이미 배지 있음 → 종류·조건 확장 |
| **해금 콘텐츠** | Elite일 때만 접근 가능한 시나리오/에피소드/문서. (§4-1과 동일) | 우선순위 1 |
| **멘토 배지·노출 확장** | “Elite 멘토” 문구·아이콘. (§4-2와 동일) | 우선순위 2 |

- **프로젝트 백로그**: 위 아이디어의 **우선순위·스펙** 정리, “주간 vs 시즌 5%” 정책 결정 후, **`docs/PROJECT_BACKLOG.md`** 에서 구체 작업으로 쪼개어 4-4 또는 별도 이슈로 진행.

---

## 8. 완료 기준 (4-3)

- [x] Elite 5% 정의·현행 API 정리.
- [x] 후보 4가지(특별 프로젝트, 멘토 프로그램, 해금 콘텐츠, 챔피언십) 요약.
- [x] 우선순위·기능별 스펙 요약 문서화.
- [x] **주간 vs 시즌 5%** 정책·특혜 종류 결정 → `docs/ELITE_5_PERCENT_POLICY.md` (1페이지).
- [x] 4-4 구현: (1) 멘토 배지 확장 — "Elite 멘토" 문구·툴팁. (2) 해금 콘텐츠 — 대시보드 "Elite 전용 콘텐츠" 카드 + `/[locale]/bty/elite` 페이지. (상세 §9)

---

## 9. 4-4 구현 완료 요약

구현한 내용만 정리. Elite 판정은 기존 **GET /api/me/elite**·**getIsEliteTop5**(주간 XP 상위 5%)만 사용. UI는 `isElite` 값만 사용하며, XP/랭킹 계산은 하지 않음.

### 1. 멘토 배지 확장 (우선순위 2)

- **파일**: `src/app/[locale]/bty/(protected)/mentor/page.client.tsx`
- `eliteMentorBadge`: "Elite 멘토" / "Elite Mentor" 추가.
- Elite일 때 뱃지 문구를 "상위 5%" → "Elite 멘토"(또는 "Elite Mentor")로 표시.
- 툴팁 `title={t.eliteBadge}` 로 "상위 5%" 설명 유지.

### 2. 해금 콘텐츠 (우선순위 1)

**대시보드** (`dashboard/page.client.tsx`):

- `GET /api/me/elite` 로 `isElite` 조회 (기존 `Promise.all` 에 포함).
- **"Elite 전용 콘텐츠"** 카드 추가:
  - Elite → `/[locale]/bty/elite` 링크.
  - 비Elite → "주간 리더보드 상위 5% 달성 시 이용 가능" 문구.

**Elite 전용 페이지** `/[locale]/bty/elite`:

- `elite/page.tsx` + `elite/page.client.tsx` 추가.
- `GET /api/me/elite` 로 Elite 여부 확인.
- **Elite**: "Elite 전용" 설명 + 멘토 심화 대화 링크 + 대시보드 돌아가기.
- **비Elite**: "상위 5% 달성 시 이용 가능" + 리더보드/대시보드 링크.

### 3. 동작 요약

- Elite 판정: 기존 `GET /api/me/elite`·`getIsEliteTop5`(주간 XP 상위 5%)만 사용.
- UI는 `isElite` 값만 사용하며, XP/랭킹 계산은 하지 않음.
- 비Elite가 `/bty/elite` 에 직접 진입해도 API 결과에 따라 "상위 5% 달성 시 이용 가능"만 노출.

---

## 10. 엘리트 특혜 1~2차 선정 결과 (PROJECT_BACKLOG §5)

후보 중 **1~2차 구현 항목** 선정·한 줄 스펙. 4-4에서 이미 반영된 항목 포함.

| 차수 | 항목 | 한 줄 스펙 | 상태 |
|------|------|------------|------|
| **1차** | 해금 콘텐츠 | Elite만 접근 가능한 전용 페이지(`/bty/elite`) + 대시보드 카드 노출, 비Elite는 "상위 5% 달성 시 이용 가능" 문구. | [x] 완료 |
| **2차** | 멘토 배지·노출 확장 | 멘토 페이지에서 Elite일 때 "Elite 멘토" 문구·툴팁으로 상위 5% 뱃지 확장. | [x] 완료 |
| **3차 후보** | 엘리트 배지 증정 | 주간 5% 달성 시 배지 수여·기존 "상위 5%" 뱃지를 시즌/주간 구분 또는 아이콘 확장. | [ ] |
| **3차 후보** | 멘토 대화 신청 | Elite가 Dr. Chi(또는 지정 멘토)와 1:1 세션 신청 권한, 신청 큐·승인 플로우 API·UI. | [ ] |
| **엘리트 2차** | 챔피언십 | 주간 상위 1~3명 선정·공개. 리더보드 API `champions` + 리더보드 페이지 상단 "이번 주 챔피언" 영역. | [x] 완료 |

**선정 요약**: 1~2차는 해금 콘텐츠·멘토 배지 확장으로 확정·구현 완료. 엘리트 2차로 챔피언십(주간 1~3명) 구현 완료. 3차는 엘리트 배지 증정·멘토 대화 신청 중 우선순위 정해 별도 이슈로 진행.

---

## 11. 엘리트 2차 구현 (챔피언십) — NEXT_TASKS_2 §1-4

**범위**: 챔피언십(주간 1~3명 선정·공개). 스펙 §4-4.

- **API** (`src/app/api/arena/leaderboard/route.ts`): 응답에 `champions` 필드 추가 (주간 `weekly_xp` 상위 3명, 기존 leaderboard 배열과 동일 구조).
- **UI** (`src/app/[locale]/bty/leaderboard/page.tsx`): 리더보드 상단에 "이번 주 챔피언" / "This week's champions" 블록. 1위 = Champion, 2~3위 = Runner-up. 아바타·코드명·주간 XP 표시.
- **데이터**: 새 테이블 없음. 기존 리더보드 쿼리 결과에서 상위 3명만 별도 필드로 반환.
