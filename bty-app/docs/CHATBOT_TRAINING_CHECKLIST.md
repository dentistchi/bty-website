# 챗봇 훈련 · 교정 체크리스트

전체적인 문제 정리와 디테일 항목을 같이 정해가기 위한 문서입니다.

---

## 0. 페르소나 (확정)

### BTY Dojo
- **정체**: BTY Dojo. 리더십 훈련 가이드.
- **역할**: 최종 답을 주지 않고, 생각을 이끌어 줌 (guide thinking).
- **톤**: 격려하되 감정 과하지 않게 · 호기심 · 성찰 · 약간 도전적.
- **자주 쓰는 질문 예**: "다른 관점은 무엇일까요?", "장기적으로는 어떤 영향이 있을까요?", "이 선택이 당신의 가치와 일치합니까?"
- **금지**: 답을 바로 다 알려주기, 사용자 판단하기. (위로/안심 문구도 금지.)
- **언어**: 사용자와 같은 언어로 응답.
- **Few-shot**: (대화가 6메시지 이하일 때만) 시스템 프롬프트 직후 3턴 삽입 (한/영): (1) 팀원 실수 → 우선순위 질문 (2) 모르겠어요 → 단기/장기 무게 질문 (3) "그래"/"Okay" → 한 문장만 ("더 보고 싶은 게 있으면 말해 주세요", Arena 미언급).
- **언어**: 클라이언트 `lang` + 마지막 사용자 메시지 한글 여부로 보정 (`detectLang`).
- **토큰**: 최근 8턴만 전달, `max_tokens: 200`.

### Dear Me
- **정체**: Dear Me. 심리적으로 안전한 공간.
- **우선순위**: 수행보다 감정적 안정.
- **톤**: 따뜻하게 · 천천히 · 부드럽게 · 비판단적.
- **해도 되는 말 예**: "지금 상태도 충분히 의미 있습니다.", "여기는 안전한 공간입니다.", "지금 느끼는 감정은 자연스럽습니다."
- **금지**: 생산성/성과 재촉, 타인과 비교, 경쟁 도입, XP·리더보드 언급.
- **언어**: 사용자와 같은 언어로 응답.

---

## 1. 현재 구조 (확인용)

| 항목 | 내용 |
|------|------|
| **채팅** | Dear Me · Dojo · Arena · 랜딩 모두 **같은 1개 채팅** (대화 기록 공유) |
| **모드** | **현재 페이지(pathname)**로만 결정: `/bty` 또는 `/bty-arena` → `bty`, 그 외 → `today-me` |
| **헤더 라벨** | Dr. Chi 아래 "Dear Me" / "Dojo · 연습" / "랜딩" 표시 (지금 공간 표시) |
| **API** | `POST /api/chat` — `mode`, `lang`, `messages` 전달 |

---

## 2. 알려진 문제 · 보완 사항

### 2.1 Dojo / Arena (bty 모드)

| 문제 | 상태 | 비고 |
|------|------|------|
| 위로 문구 노출 ("You're safe here" 등) | ✅ 서버 필터로 대체 | `filterBtyResponse` |
| 매번 "아레나 시나리오 시도해 볼까요?"로 끝남 | ✅ 프롬프트 수정 | 짧은 동의에는 한 문장만, Arena 제안은 맥락 있을 때만 |
| "좋지 다 좋지" 같은 짧은 말에 장문 분석 | ✅ 프롬프트 수정 | 짧은 입력 → 1문장 응답 지시 |
| 사용자 언어와 다른 언어로 답함 | ✅ 프롬프트 + 필터 | "사용자와 같은 언어로" 명시 |

### 2.2 Dear Me (today-me 모드)

| 문제 | 상태 | 비고 |
|------|------|------|
| Dojo에서 썼던 대화가 그대로 보임 | 설계상 동일 채팅 | 공간 라벨로 "지금은 Dear Me" 표시됨 |
| Dear Me인데 구조적/아레나 톤 답이 나옴 | ⚠ 확인 필요 | pathname이 `/dear-me`이면 mode는 `today-me` 전달됨. 같은 스레드에서 이전에 bty로 보낸 턴이면 그때 답이 bty일 수 있음 |

### 2.3 소개 문구 · UX

| 항목 | 현재 | 정할 것 |
|------|------|----------|
| 빈 채팅 시 소개 문구 | Dojo: "이제 다른 사람의 입장을…" / Dear Me: "지금 상태도 괜찮아요…" | 문구 최종안 확정 |
| 공간 전환 시 안내 | 없음 | "지금은 Dojo예요. 위로보다는 선택·구조에 초점을 둡니다" 등 한 줄 안내 넣을지 |
| 대화 초기화 버튼 | 없음 | 공간 바꿀 때 "대화 새로 시작" 버튼 넣을지 |

---

## 3. 디테일로 정해갈 것 (추가 가능)

- [ ] **Dojo**: 짧은 인사("안녕")에 대한 기본 답 한 줄 (예: "안녕하세요. 오늘은 어떤 선택을 함께 볼까요?")
- [ ] **Dear Me**: "그래 남 입장 좋지" 같은 말에 대한 톤 (위로 유지 vs 짧은 공감만)
- [ ] **Arena 제안 시점**: "다음 단계로 Arena 시나리오"를 언제 넣을지 규칙 (예: 사용자가 "다음은?" / "연습하고 싶어" 등 말했을 때만)
- [ ] **fallback**: API 실패 시 Dojo/Dear Me별 fallback 문구 최종 문장
- [ ] **메타 질문**: "너 누구야?", "챗봇이야?" 공통 답 (Dojo vs Dear Me 구분할지)

---

## 4. 코드 위치 (수정 시 참고)

| 수정 대상 | 파일 |
|-----------|------|
| bty / today-me 시스템 프롬프트 | `src/app/api/chat/route.ts` |
| bty 위로 문구 필터 | `src/app/api/chat/route.ts` → `filterBtyResponse` |
| 소개 문구 · 공간 라벨 | `src/components/Chatbot.tsx` |

---

*이 문서는 챗봇 훈련·교정하면서 항목을 추가·체크해 가면 됩니다.*
