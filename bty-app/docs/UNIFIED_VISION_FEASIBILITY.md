# 하나로 합치는 구상 — 구현 가능성 정리

말씀하신 큰 그림(게임하면서 챗봇 대화 → 자존감 낮으면 Dear Me 추천, 공부 필요하면 Dojo 추천 / Arena 고단계에서 직접 타이핑 → 칭찬·보완으로 성장 / 훈련장·Dear Me 시간도 XP / Dr. Chi 면담 등)을 현재 코드베이스 기준으로 **어디까지 이미 되어 있고, 어디를 추가하면 되는지** 정리한 문서입니다.

---

## 1. 현재 구조 요약

### 챗봇 (전역)

- **위치**: `app/layout.tsx`에서 `<Chatbot />` 한 번만 렌더 → **모든 페이지**(랜딩, Arena, Dojo, Dear Me)에 **같은 플로팅 챗봇**이 이미 노출됨.
- **API**: `POST /api/chat`
  - `mode`: **경로 기준**으로 결정됨 (`pathname.includes("/bty")` → `"bty"`, 아니면 `"today-me"`).
  - `/en/bty-arena`는 `/bty`를 포함하므로 **지금도 Arena에서는 이미 "bty" 모드**가 적용됨 (연습/코치 톤).
- **역할**:
  - **today-me**: Dear Me 톤 — “안전해요, 그대로 괜찮아요” (평가·격려 금지).
  - **bty**: Dojo 톤 — “다른 사람 입장 생각해볼까요? 연습해볼까요?”

→ **세 곳 모두에서 같은 챗봇을 쓰는 것은 이미 가능**하고, Arena에서도 챗봇은 Dojo 스타일로 동작 중.

### Dr. Chi 멘토 (Dojo 전용)

- **위치**: Dojo 내부 `/[locale]/bty/mentor` (Dr. Chi's Mentor).
- **API**: `POST /api/mentor`
  - 5가지 주제 선택 → **Gemini**로 대화.
  - **감정 안전 밸브**: 사용자 메시지에서 “못하겠어”, “자격 없어”, “너무 힘들어” 등 **낮은 자존감 패턴** 감지 시 → **Dear Me로 가서 쉬라고 안내**하는 고정 메시지 반환.
- **역할**: 주제별로 깊이 있는 대화 + 필요 시 Dear Me 유도.

→ **“자존감 낮을 때 Dear Me 추천”** 로직은 **멘토 API에 이미 구현**되어 있음.  
다만 이건 **멘토 페이지 전용**이고, **전역 챗봇(`/api/chat`)에는 아직** 같은 밸브가 없음.

### Arena

- 시나리오 선택 → **7단계 구조** (선택지 버튼 → 결과 → 반성 → follow-up 등).
- XP는 **선택/이벤트 기반**으로만 적립 (직접 타이핑 답변은 없음).
- Dojo/Dear Me 이용 시간·대화는 **XP와 연동되지 않음**.

---

## 2. 말씀하신 구상 vs 구현 가능성

| 구상 | 현재 상태 | 구현 가능성 |
|------|-----------|-------------|
| **세 곳을 결국 하나로** | 하나의 앱, 랜딩에서 Arena/Dojo/Dear Me 선택. 챗봇은 이미 전역. | ✅ 이미 “한 사이트”. 흐름만 정리하면 됨. |
| **게임하면서 챗봇과 대화** | Arena에서도 플로팅 챗봇 노출됨. mode는 bty. | ✅ 가능. 필요하면 Arena 전용 모드만 추가. |
| **자존감 낮으면 Dear Me 추천** | `/api/mentor`에만 안전 밸브 있음. `/api/chat`에는 없음. | ✅ **쉬움**: `/api/chat`에 mentor와 같은 패턴 감지 + Dear Me 링크 메시지 추가하면 됨. |
| **공부 필요하면 Dojo 추천** | 없음. | ✅ **가능**: 챗봇 시스템 프롬프트에 “학습/연습이 필요해 보이면 Dojo(멘토·역지사지) 추천” 규칙 추가. 휴리스틱 또는 나중에 LLM 판단. |
| **Arena: 고단계에서 직접 타이핑** | 지금은 7단계 선택지만. | ✅ **가능**: 시나리오 + 사용자 자유 입력을 받는 API 하나 추가 (기존 mentor/chat와 유사). 응답으로 “잘한 점 / 보완점” + XP 계산 규칙 설계. |
| **칭찬·부족한 부분 도와주기** | 멘토/챗은 대화형. Arena는 선택지 피드백만. | ✅ **가능**: 자유 입력 단계에서 LLM(또는 규칙)으로 “칭찬 + 보완 제안” 생성. Dojo/멘토와 같은 톤 재사용 가능. |
| **훈련장·Dear Me 시간도 XP** | Arena만 XP. Dojo/Dear Me는 미연동. | ✅ **가능**: “Dojo 체류/멘토 대화 횟수”, “Dear Me 체류/챗 횟수” 등을 정의해 `arena_events` 또는 `weekly_xp`에 이벤트로 쌓으면 됨. 설계만 하면 구현 난이도는 중간. |
| **Dr. Chi와 면담(챗)을 세 곳 모두에서** | 멘토 페이지(Dojo)에서만 “Dr. Chi 면담” 형태. | ✅ **가능**: (1) 전역 챗봇을 “Dr. Chi”로 통일하거나, (2) “닥터 Chi와 면담하기” 버튼을 Arena/Dear Me에도 두고, 클릭 시 멘토와 같은 채팅 UI/API(`/api/mentor`)를 열어주면 됨. |
| **단계 높을수록 더 깊이 배움** | 멘토는 주제 선택 후 대화. “단계”는 Arena Tier 등과 연동 가능. | ✅ **가능**: Tier/레벨을 ` /api/mentor`에 넘기고, 프롬프트에서 “단계가 높으면 더 구체적/심화 질문” 하도록 하면 됨. |

---

## 3. 단계별로 보면

### 이미 되어 있는 것

- **한 사이트**에서 Arena / Dojo / Dear Me 제공.
- **같은 챗봇**이 세 곳 모두에 노출 (전역 레이아웃).
- Arena에서는 챗봇이 **bty(연습/코치)** 모드.
- **Dojo 멘토**에서 “자존감 낮을 때 Dear Me 추천” 로직 존재.

### 비교적 빠르게 할 수 있는 것

1. **전역 챗봇에 “Dear Me 추천” 밸브**  
   - `/api/chat`에서 사용자 메시지에 `LOW_SELF_ESTEEM_PATTERNS`(또는 유사) 적용 → 해당 시 “Dear Me에서 쉬어보세요” + `/{locale}/dear-me` 링크 메시지 반환.
2. **“Dojo 추천”**  
   - 챗봇 시스템 프롬프트에 “연습/학습이 필요해 보이면 Dojo(멘토·역지사지) 안내” 추가. 필요 시 `/{locale}/bty` 또는 `/{locale}/bty/mentor` 링크 포함.
3. **Arena/Dear Me에서 “닥터 Chi와 면담하기”**  
   - Arena·Dear Me 페이지에 버튼/링크 추가 → 클릭 시 기존 멘토 채팅 UI(또는 전역 챗을 멘토 모드로 전환)로 이동. 백엔드는 `/api/mentor` 재사용.

### 중기 (설계 후 구현)

4. **Arena 고단계 “직접 타이핑”**  
   - 시나리오 + 사용자 자유 입력 입력받는 API (예: `POST /api/arena/free-response`) 추가.  
   - 응답: “잘한 점 / 보완점” 문장 + XP 규칙(예: 구간별 점수). 기존 시나리오 엔진과 조합 가능.
5. **Dojo/Dear Me 활동 XP**  
   - “멘토 메시지 1회”, “Dear Me 챗 1회”, “Dojo 페이지 체류 5분” 등 정의 후, `arena_events` 또는 `weekly_xp`에 이벤트 기록. 기존 XP/리더보드와 통합 여부만 정하면 됨.

### 장기 (큰 그림 정리)

6. **전체를 “게임장”처럼**  
   - 모든 활동(Arena 플레이, Dojo 면담, Dear Me 대화)을 한 흐름으로 보여주는 대시/요약.  
   - 챗봇을 “Dr. Chi” 하나로 통일하고, 구역별로 톤만 바꾸기 (Arena=선택·성장, Dojo=교육, Dear Me=안전).

---

## 4. 정리

- **세 곳을 하나로 합치는 것**: 이미 한 앱이고, 챗봇도 세 곳 공통으로 쓰고 있음.
- **같은 챗봇을 세 곳에서 쓰는 것**: ✅ 이미 가능하고, Arena는 이미 bty 모드.
- **자존감 낮을 때 Dear Me 추천**: ✅ 멘토에 구현됨. 전역 챗에 같은 로직만 넣으면 됨.
- **공부 필요하면 Dojo 추천**: ✅ 챗봇 프롬프트/로직 확장으로 가능.
- **Arena 고단계 직접 타이핑 + 칭찬/보완**: ✅ 새 API + 프롬프트/규칙으로 단계적으로 가능.
- **훈련장·Dear Me 시간도 XP**: ✅ 이벤트 정의 후 기존 XP 파이프라인에 붙이면 됨.
- **Dr. Chi와 면담을 세 곳에서**: ✅ “면담” = 기존 멘토 채팅 UI/API 재사용 + Arena/Dear Me에서 진입점만 추가.

**결론**: 말씀하신 방향은 **현재 구조 위에서 단계적으로 구현 가능**합니다.  
우선 **전역 챗봇에 Dear Me/Dojo 추천(밸브)** 를 넣고, 그다음 **Arena 자유 입력 단계**와 **Dojo/Dear Me XP** 설계를 이어가는 순서를 추천합니다.
